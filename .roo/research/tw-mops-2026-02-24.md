# Research Log: Taiwan MOPS
**Generated**: 2026-02-24T15:39:00Z
**Status**: Complete

---

## 1. VERSION INFORMATION

No library -- scraper-based wrapper using direct form POST.

---

# =====================================================================
# PART A: UNOFFICIAL COMMUNITY WRAPPER
# =====================================================================

**No unofficial wrapper used in our codebase.**

A community library `twstock` (v1.4.0) exists on PyPI for TWSE price data
(see `.roo/research/unofficial-wrapper-discovery-2026-02-24.md`), but it
does NOT provide MOPS financial statement scraping. Our wrapper uses
direct form POST, which is the standard approach for MOPS since no
official REST API exists.

---

# =====================================================================
# PART B: GOVERNMENT DATA SOURCE -- MOPS + TWSE
# =====================================================================

## B1. MOPS (Market Observation Post System)

**Source**: https://mops.twse.com.tw (verified 2026-02-24 -- site returns HTML)
**Source**: `MOP Api doc` in repo root

### Verbatim from MOP Api doc (lines 1-4)
```
# COPIED VERBATIM
Here are the most relevant unofficial / community wrappers, scrapers, and
libraries for accessing TWSE MOPS (Market Observation Post System) data
programmatically. These are primarily open-source projects on GitHub that
simulate form submissions (POST requests) to MOPS endpoints since there
is no free public REST API.
```

### Form POST Endpoints (from our wrapper code -- verified against MOP Api doc)
```
# COPIED FROM tw_mops_wrapper.py, verified against MOP Api doc recommendations
POST https://mops.twse.com.tw/mops/web/ajax_{step}

Form data:
  encodeURIComponent: 1
  step: 1
  firstin: 1
  off: 1
  co_id: {stock_code}
  year: {ROC_year}
  season: {1-4}

Step codes for financial statements:
  t163sb04: Income statement
  t163sb05: Balance sheet
  t163sb20: Cash flow
```

### Verbatim from MOP Api doc (implementation tips, lines 47-50)
```
# COPIED VERBATIM
- Use `requests.Session()` for persistent cookies (MOPS forms often require it).
- Set headers: User-Agent, Referer to mimic browser.
- Handle encoding: response.encoding = 'big5' or 'utf-8'.
- Parse tables: `pandas.read_html(response.text)` or BeautifulSoup.
```

## B2. TWSE (Taiwan Stock Exchange -- company list)

**Endpoint**: `https://www.twse.com.tw/exchangeReport/STOCK_DAY_ALL?response=json`
**No key required**

Used by our wrapper for `list_companies()`. Returns JSON array of stock data.

## B3. ROC Date Conversion

Our wrapper correctly handles ROC calendar:
```python
# From tw_mops_wrapper.py -- VERIFIED
def _roc_to_ce(roc_year: int) -> int:
    """Convert ROC year to Common Era year. ROC 113 = CE 2024."""
    return roc_year + 1911

def _ce_to_roc(ce_year: int) -> int:
    return ce_year - 1911
```
For 2026: ROC 115 = CE 2026. This is correct.

## B4. Canonical Field Coverage (via _TIFRS_MAP in canonical_translator.py)

Chinese field names from MOPS mapped to canonical:
```
# VERBATIM from canonical_translator.py
"營業收入合計": "revenue",
"營業成本合計": "cost_of_revenue",
"營業毛利（毛損）": "gross_profit",
"營業利益（損失）": "operating_income",
"本期淨利（淨損）": "net_income",
"稅前淨利（淨損）": "ebit",
"所得稅費用（利益）": "taxes",
"利息費用": "interest_expense",
```

---

# =====================================================================
# PART C: SUMMARY
# =====================================================================

| Mode | Component | Status |
|------|-----------|--------|
| Unofficial | (none -- twstock available but not for MOPS financial data) | N/A |
| Government | MOPS form POST + TWSE JSON | WORKING -- endpoints documented in repo |

### Required Fixes
1. **NONE critical** -- form POST pattern and TIFRS mapping are correct
2. **MINOR**: MOPS form endpoints need runtime verification (scraper-fragile)

---

**END OF RESEARCH LOG**
